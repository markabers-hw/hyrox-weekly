<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Premium - Hyrox Weekly</title>
<meta name="description" content="Hyrox Weekly Premium - Early access, athlete deep dives, and performance guides.">

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<!-- Stripe -->
<script src="https://js.stripe.com/v3/"></script>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Barlow', sans-serif; line-height: 1.6; color: #1a1a1a; background: #1a1a1a; min-height: 100vh; }

/* Navigation */
.nav {
  padding: 16px 0;
  position: fixed;
  width: 100%;
  top: 0;
  z-index: 1000;
  background: rgba(26,26,26,0.95);
  backdrop-filter: blur(10px);
}
.nav-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 24px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.nav-brand {
  font-weight: 800;
  font-size: 18px;
  color: #fff;
  text-decoration: none;
  letter-spacing: 3px;
}
.nav-links {
  display: flex;
  gap: 32px;
  align-items: center;
}
.nav-links a {
  color: rgba(255,255,255,0.7);
  text-decoration: none;
  font-size: 14px;
  font-weight: 500;
}
.nav-links a:hover { color: #fff; }
.nav-links a.active { color: #CC5500; }

/* Hero */
.premium-hero {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  text-align: center;
  padding: 120px 24px 60px;
  background: linear-gradient(180deg, #1a1a1a 0%, #2d2d2d 50%, #1a1a1a 100%);
}

/* Early Bird Banner */
.early-bird-banner {
  background: linear-gradient(90deg, #CC5500, #ff6b35);
  color: #fff;
  font-size: 13px;
  font-weight: 700;
  padding: 8px 20px;
  border-radius: 20px;
  letter-spacing: 1px;
  text-transform: uppercase;
  margin-bottom: 30px;
  display: flex;
  align-items: center;
  gap: 8px;
}
.early-bird-banner.sold-out {
  background: #666;
}
.early-bird-count {
  background: rgba(0,0,0,0.2);
  padding: 2px 8px;
  border-radius: 10px;
  font-size: 12px;
}

.premium-hero h1 {
  color: #fff;
  font-size: 48px;
  font-weight: 800;
  letter-spacing: 4px;
  margin-bottom: 16px;
}
.premium-hero h1 span {
  color: #CC5500;
}

.premium-hero > p {
  color: rgba(255,255,255,0.6);
  font-size: 18px;
  max-width: 600px;
  margin-bottom: 40px;
}

/* Pricing Cards */
.pricing-container {
  display: flex;
  gap: 24px;
  margin-bottom: 40px;
  flex-wrap: wrap;
  justify-content: center;
}

.pricing-card {
  background: rgba(255,255,255,0.05);
  border: 2px solid rgba(255,255,255,0.1);
  border-radius: 16px;
  padding: 32px;
  width: 280px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
}
.pricing-card:hover {
  border-color: rgba(204, 85, 0, 0.5);
  transform: translateY(-4px);
}
.pricing-card.selected {
  border-color: #CC5500;
  background: rgba(204, 85, 0, 0.1);
}
.pricing-card.recommended {
  position: relative;
}
.pricing-card.recommended::before {
  content: 'BEST VALUE';
  position: absolute;
  top: -12px;
  left: 50%;
  transform: translateX(-50%);
  background: #CC5500;
  color: #fff;
  font-size: 10px;
  font-weight: 700;
  padding: 4px 12px;
  border-radius: 10px;
  letter-spacing: 1px;
}

.pricing-label {
  color: rgba(255,255,255,0.5);
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-bottom: 8px;
}
.pricing-price {
  color: #fff;
  font-size: 48px;
  font-weight: 800;
}
.pricing-price span {
  font-size: 18px;
  font-weight: 500;
  color: rgba(255,255,255,0.5);
}
.pricing-original {
  color: rgba(255,255,255,0.4);
  font-size: 14px;
  text-decoration: line-through;
  margin-top: 4px;
  height: 20px;
}
.pricing-savings {
  background: rgba(0, 200, 100, 0.2);
  color: #00c864;
  font-size: 12px;
  font-weight: 600;
  padding: 4px 10px;
  border-radius: 10px;
  margin-top: 12px;
  display: inline-block;
}

/* Features List */
.features-list {
  max-width: 500px;
  margin-bottom: 40px;
  text-align: left;
}
.features-list h3 {
  color: #fff;
  font-size: 16px;
  font-weight: 600;
  margin-bottom: 16px;
  text-align: center;
}
.feature-item {
  display: flex;
  align-items: center;
  gap: 12px;
  color: rgba(255,255,255,0.7);
  font-size: 15px;
  padding: 8px 0;
}
.feature-item .check {
  color: #00c864;
  font-size: 18px;
}

/* Checkout Form */
.checkout-container {
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 16px;
  padding: 32px;
  max-width: 500px;
  width: 100%;
}
.checkout-container h3 {
  color: #fff;
  font-size: 20px;
  margin-bottom: 20px;
}

.form-group {
  margin-bottom: 20px;
}
.form-group label {
  display: block;
  color: rgba(255,255,255,0.6);
  font-size: 13px;
  font-weight: 500;
  margin-bottom: 8px;
}
.form-group input {
  width: 100%;
  padding: 14px 16px;
  font-size: 16px;
  font-family: inherit;
  border: 2px solid rgba(255,255,255,0.1);
  border-radius: 8px;
  background: rgba(255,255,255,0.05);
  color: #fff;
  outline: none;
  transition: border-color 0.2s;
}
.form-group input:focus {
  border-color: #CC5500;
}
.form-group input::placeholder {
  color: rgba(255,255,255,0.3);
}

.checkout-btn {
  width: 100%;
  padding: 16px;
  font-size: 16px;
  font-weight: 700;
  font-family: inherit;
  background: linear-gradient(90deg, #CC5500, #ff6b35);
  color: #fff;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
  letter-spacing: 1px;
}
.checkout-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(204, 85, 0, 0.3);
}
.checkout-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

.checkout-note {
  color: rgba(255,255,255,0.4);
  font-size: 12px;
  margin-top: 16px;
  text-align: center;
}

/* Error message */
.error-message {
  background: rgba(255, 50, 50, 0.1);
  border: 1px solid rgba(255, 50, 50, 0.3);
  color: #ff6b6b;
  padding: 12px;
  border-radius: 8px;
  margin-bottom: 20px;
  font-size: 14px;
  display: none;
}

/* Already a member */
.member-login {
  margin-top: 24px;
  padding-top: 24px;
  border-top: 1px solid rgba(255,255,255,0.1);
  text-align: center;
}
.member-login p {
  color: rgba(255,255,255,0.5);
  font-size: 14px;
}
.member-login a {
  color: #CC5500;
  text-decoration: none;
  font-weight: 600;
}
.member-login a:hover {
  text-decoration: underline;
}

/* Login form (hidden by default) */
.login-form {
  display: none;
  margin-top: 16px;
}
.login-form.show {
  display: block;
}

/* Footer */
.footer {
  padding: 40px 24px;
  text-align: center;
}
.footer p {
  color: rgba(255,255,255,0.3);
  font-size: 12px;
}
.footer a {
  color: rgba(255,255,255,0.5);
  text-decoration: none;
  margin: 0 12px;
}

/* Responsive */
@media (max-width: 700px) {
  .premium-hero h1 { font-size: 32px; }
  .pricing-container { flex-direction: column; align-items: center; }
  .pricing-card { width: 100%; max-width: 320px; }
  .nav-links { display: none; }
  .checkout-container { margin: 0 10px; padding: 24px 20px; }
}
</style>
</head>
<body>

<!-- Navigation -->
<nav class="nav">
  <div class="nav-container">
    <a href="/" class="nav-brand">HYROX WEEKLY</a>
    <div class="nav-links">
      <a href="/archive">Archive</a>
      <a href="/premium" class="active">Premium</a>
      <a href="/#subscribe">Subscribe</a>
    </div>
  </div>
</nav>

<!-- Hero -->
<section class="premium-hero">
  <!-- Early Bird Banner (dynamic) -->
  <div class="early-bird-banner" id="earlyBirdBanner">
    <span>EARLY BIRD PRICING</span>
    <span class="early-bird-count" id="earlyBirdCount">100 spots left</span>
  </div>

  <h1>HYROX WEEKLY<br><span>PREMIUM</span></h1>

  <p>Get early access to each edition, exclusive athlete profiles, and in-depth performance guides for every station.</p>

  <!-- Pricing Cards -->
  <div class="pricing-container">
    <div class="pricing-card" id="monthlyCard" onclick="selectPlan('monthly')">
      <div class="pricing-label">Monthly</div>
      <div class="pricing-price" id="monthlyPrice">$4<span>/mo</span></div>
      <div class="pricing-original" id="monthlyOriginal">$5/mo after early bird</div>
    </div>

    <div class="pricing-card recommended selected" id="yearlyCard" onclick="selectPlan('yearly')">
      <div class="pricing-label">Yearly</div>
      <div class="pricing-price" id="yearlyPrice">$30<span>/yr</span></div>
      <div class="pricing-original" id="yearlyOriginal">$39/yr after early bird</div>
      <div class="pricing-savings">Save 35%</div>
    </div>
  </div>

  <!-- Features -->
  <div class="features-list">
    <h3>What's Included</h3>
    <div class="feature-item"><span class="check">&#10003;</span> Early access to editions (24hr before public)</div>
    <div class="feature-item"><span class="check">&#10003;</span> Full newsletter archive</div>
    <div class="feature-item"><span class="check">&#10003;</span> Athlete Editions - in-depth profiles of top competitors</div>
    <div class="feature-item"><span class="check">&#10003;</span> Performance Editions - deep dives on every station</div>
    <div class="feature-item"><span class="check">&#10003;</span> Cancel anytime</div>
  </div>

  <!-- Checkout Form -->
  <div class="checkout-container">
    <h3>Start Your Subscription</h3>

    <div class="error-message" id="errorMessage"></div>

    <form id="checkoutForm">
      <div class="form-group">
        <label for="email">Email address</label>
        <input type="email" id="email" name="email" placeholder="you@example.com" required>
      </div>

      <button type="submit" class="checkout-btn" id="checkoutBtn">
        Subscribe Now
      </button>
    </form>

    <p class="checkout-note">Secure payment via Stripe. Cancel anytime.</p>

    <!-- Already a member -->
    <div class="member-login">
      <p>Already a premium member? <a href="#" onclick="toggleLoginForm(event)">Get login link</a></p>

      <div class="login-form" id="loginForm">
        <form id="magicLinkForm">
          <div class="form-group">
            <input type="email" id="loginEmail" placeholder="Enter your email" required>
          </div>
          <button type="submit" class="checkout-btn" style="background: #444;">Send Login Link</button>
        </form>
      </div>
    </div>
  </div>
</section>

<!-- Footer -->
<footer class="footer">
  <p>
    <a href="/">Home</a>
    <a href="/archive">Archive</a>
    <a href="mailto:team@hyroxweekly.com">Contact</a>
  </p>
  <p style="margin-top: 16px;">&copy; 2025 Hyrox Weekly. Not affiliated with HYROX GmbH.</p>
</footer>

<script>
// State
let selectedPlan = 'yearly';
let pricing = null;

// Initialize Stripe
const stripe = Stripe('pk_test_51Snuh91TX00b14bIi6HFf8PILqhamtYFcSZjL8klNHxznzvobV6okeeBhZk6vpEcRv8TKoBE3hX8qOobpaZH3tdd003QfMVBPd');

// Load pricing on page load
async function loadPricing() {
  try {
    const response = await fetch('/api/get-pricing');
    pricing = await response.json();
    updatePricingDisplay();
  } catch (error) {
    console.error('Failed to load pricing:', error);
    // Use default early bird pricing
    pricing = {
      isEarlyBirdAvailable: true,
      earlyBirdRemaining: 100,
      prices: {
        monthly: { current: 400, regular: 500 },
        yearly: { current: 3000, regular: 3900 }
      }
    };
    updatePricingDisplay();
  }
}

function updatePricingDisplay() {
  const banner = document.getElementById('earlyBirdBanner');
  const countEl = document.getElementById('earlyBirdCount');

  if (pricing.isEarlyBirdAvailable) {
    countEl.textContent = `${pricing.earlyBirdRemaining} spots left`;

    // Update prices
    document.getElementById('monthlyPrice').innerHTML = `$${pricing.prices.monthly.current / 100}<span>/mo</span>`;
    document.getElementById('yearlyPrice').innerHTML = `$${pricing.prices.yearly.current / 100}<span>/yr</span>`;
    document.getElementById('monthlyOriginal').textContent = `$${pricing.prices.monthly.regular / 100}/mo after early bird`;
    document.getElementById('yearlyOriginal').textContent = `$${pricing.prices.yearly.regular / 100}/yr after early bird`;
  } else {
    banner.classList.add('sold-out');
    banner.innerHTML = '<span>EARLY BIRD SOLD OUT</span>';

    // Show regular prices
    document.getElementById('monthlyPrice').innerHTML = `$${pricing.prices.monthly.regular / 100}<span>/mo</span>`;
    document.getElementById('yearlyPrice').innerHTML = `$${pricing.prices.yearly.regular / 100}<span>/yr</span>`;
    document.getElementById('monthlyOriginal').textContent = '';
    document.getElementById('yearlyOriginal').textContent = '';
  }
}

function selectPlan(plan) {
  selectedPlan = plan;

  document.getElementById('monthlyCard').classList.toggle('selected', plan === 'monthly');
  document.getElementById('yearlyCard').classList.toggle('selected', plan === 'yearly');
}

function toggleLoginForm(e) {
  e.preventDefault();
  document.getElementById('loginForm').classList.toggle('show');
}

// Checkout form submission
document.getElementById('checkoutForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  const email = document.getElementById('email').value;
  const btn = document.getElementById('checkoutBtn');
  const errorEl = document.getElementById('errorMessage');

  btn.disabled = true;
  btn.textContent = 'Loading...';
  errorEl.style.display = 'none';

  try {
    const priceId = selectedPlan === 'yearly'
      ? pricing.prices.yearly.priceId
      : pricing.prices.monthly.priceId;

    const response = await fetch('/api/create-checkout-session', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, priceId })
    });

    const data = await response.json();

    if (data.error) {
      throw new Error(data.error);
    }

    // Redirect to Stripe Checkout
    window.location.href = data.url;

  } catch (error) {
    errorEl.textContent = error.message || 'Something went wrong. Please try again.';
    errorEl.style.display = 'block';
    btn.disabled = false;
    btn.textContent = 'Subscribe Now';
  }
});

// Magic link form submission
document.getElementById('magicLinkForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  const email = document.getElementById('loginEmail').value;
  const btn = e.target.querySelector('button');

  btn.disabled = true;
  btn.textContent = 'Sending...';

  try {
    await fetch('/api/send-magic-link', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email })
    });

    btn.textContent = 'Check your email!';

  } catch (error) {
    btn.textContent = 'Send Login Link';
    btn.disabled = false;
  }
});

// Check for error params
const urlParams = new URLSearchParams(window.location.search);
const errorParam = urlParams.get('error');
if (errorParam) {
  const errorEl = document.getElementById('errorMessage');
  const messages = {
    'missing_token': 'Login link is invalid.',
    'invalid_token': 'Login link has expired. Please request a new one.',
    'verification_failed': 'Verification failed. Please try again.'
  };
  errorEl.textContent = messages[errorParam] || 'An error occurred.';
  errorEl.style.display = 'block';
}

// Load pricing on page load
loadPricing();
</script>

</body>
</html>
